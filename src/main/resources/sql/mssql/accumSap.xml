<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="eorder.accumSap">

	<select id="getNotShippedVolume" parameterType="hashmap" resultType="hashmap">
		SELECT 
			SO.PLANT_CD
			, P.PT_NAME AS PLANT_NM
			, ROUND(SUM(CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' 
				THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
				ELSE 0 END), 0) AS Board
			, ROUND(SUM(CASE WHEN IH.PROD_HIERARCHY='91170000' 
				THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
				ELSE 0 END), 0) AS Bond
			, ROUND(SUM(CASE WHEN IH.PROD_HIERARCHY='91052105' 
				THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
				ELSE 0 END), 0) AS Gyptex
		FROM O_SALESORDER SO
		LEFT JOIN O_ITEM_HEBE IH ON SO.ITEM_CD = IH.ITEM_CD
		LEFT JOIN PLANT P ON P.WERKS = SO.PLANT_CD
		WHERE SO.ACTUAL_SHIP_DT BETWEEN #{fDt} AND #{tDt}
			AND SO.STATUS1 <![CDATA[<]]> '580'
			AND SO.STATUS1 <![CDATA[<>]]> '980'
			AND SO.ORDERTY = 'OR'
			AND SO.PLANT_CD IS NOT NULL
			AND ( (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR (IH.PROD_HIERARCHY IN ('91170000', '91052105', '91052000')) )
		GROUP BY SO.PLANT_CD, P.PT_NAME
		ORDER BY SO.PLANT_CD 
	</select>
	
	<select id="getShippedVolume_20241121" parameterType="hashmap" resultType="hashmap">
		SELECT XX.* FROM (
			(
				SELECT 
					A.ACTUAL_SHIP_DT
					, A.PLANT_CD
					, P.PT_NAME AS PLANT_NM
					, A.CATEG
					, A.UNIT
					, ROUND(SUM(A.ROUTE_513)) AS ROUTE_513
					, ROUND(SUM(A.ROUTE_503)) AS ROUTE_503
					, ROUND(SUM(A.SUMM)) AS SUMM
					, ROUND(SUM(A.CM1)) AS CM1
					, ROUND(SUM(A.CM2)) AS CM2
					, ROUND(SUM(A.CP)) AS CP
					, ROUND(SUM(A.DM1)) AS DM1
					, ROUND(SUM(A.DM2)) AS DM2
					, ROUND(SUM(A.GC)) AS GC
					, ROUND(SUM(A.DP)) AS DP
				FROM (
					SELECT SO.ACTUAL_SHIP_DT, SO.PLANT_CD 
						, (CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'BOARD'
								WHEN IH.PROD_HIERARCHY='91170000' THEN 'BOND'
								WHEN IH.PROD_HIERARCHY='91052105' THEN 'GYPTEX' ELSE '' END) AS CATEG
						, (CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'M2'
								WHEN IH.PROD_HIERARCHY='91170000' THEN 'KG'
								WHEN IH.PROD_HIERARCHY='91052105' THEN 'PAC' ELSE '' END) AS UNIT
						, SUM(CASE WHEN SO.ACTUAL_SHIP_DT=SO.REQUEST_DT 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS ROUTE_513
						, SUM(CASE WHEN SO.ACTUAL_SHIP_DT <![CDATA[<>]]> SO.REQUEST_DT 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS ROUTE_503
						, SUM(SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)) AS SUMM
						, SUM(CASE WHEN SO.TEAM_CD = 'KR6' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS CM1
						, SUM(CASE WHEN SO.TEAM_CD = 'KR7' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS CM2
						, SUM(CASE WHEN SO.TEAM_CD = 'KR8' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS CP
						, SUM(CASE WHEN SO.TEAM_CD = 'KR1' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS DM1
						, SUM(CASE WHEN SO.TEAM_CD = 'KR2' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS DM2
						, SUM(CASE WHEN SO.TEAM_CD = 'KR4' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS GC
						, SUM(CASE WHEN SO.TEAM_CD = 'KR3' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS DP
					FROM O_SALESORDER SO
					LEFT JOIN O_ITEM_HEBE IH ON SO.ITEM_CD = IH.ITEM_CD 
					WHERE SO.ACTUAL_SHIP_DT = #{dt}
						AND SO.STATUS1 <![CDATA[<>]]> '980'
						AND SO.ORDERTY = 'OR'
						AND SO.PLANT_CD IS NOT NULL
						AND ( (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR (IH.PROD_HIERARCHY IN ('91170000', '91052105', '91052000')) )
					GROUP BY SO.ACTUAL_SHIP_DT, SO.PLANT_CD, IH.PROD_HIERARCHY, SO.PLANT_DESC,
						(CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'BOARD'
								WHEN IH.PROD_HIERARCHY='91170000' THEN 'BOND'
								WHEN IH.PROD_HIERARCHY='91052105' THEN 'GYPTEX' ELSE '' END)
				) A 
				LEFT JOIN PLANT P ON P.WERKS = A.PLANT_CD
				GROUP BY A.ACTUAL_SHIP_DT, A.PLANT_CD, A.CATEG, A.UNIT, P.PT_NAME
			)
			UNION ALL 
			(
				SELECT 
					 '' AS ACTUAL_SHIP_DT
					, 'Total' AS PLANT_CD
					, '' AS PLANT_NM
					, A.CATEG
					, A.UNIT
					, ROUND(SUM(A.ROUTE_513)) AS ROUTE_513
					, ROUND(SUM(A.ROUTE_503)) AS ROUTE_503
					, ROUND(SUM(A.SUMM)) AS SUMM
					, ROUND(SUM(A.CM1)) AS CM1
					, ROUND(SUM(A.CM2)) AS CM2
					, ROUND(SUM(A.CP)) AS CP
					, ROUND(SUM(A.DM1)) AS DM1
					, ROUND(SUM(A.DM2)) AS DM2
					, ROUND(SUM(A.GC)) AS GC
					, ROUND(SUM(A.DP)) AS DP
				FROM (
					SELECT 
						(CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'BOARD'
									WHEN IH.PROD_HIERARCHY='91170000' THEN 'BOND'
									WHEN IH.PROD_HIERARCHY='91052105' THEN 'GYPTEX' ELSE '' END) AS CATEG
						, (CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'M2'
								WHEN IH.PROD_HIERARCHY='91170000' THEN 'KG'
								WHEN IH.PROD_HIERARCHY='91052105' THEN 'PAC' ELSE '' END) AS UNIT
								, ROUND(SUM(CASE WHEN SO.ACTUAL_SHIP_DT=SO.REQUEST_DT 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END)) AS ROUTE_513
						, SUM(CASE WHEN SO.ACTUAL_SHIP_DT <![CDATA[<>]]> SO.REQUEST_DT 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS ROUTE_503
						, SUM(SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)) AS SUMM
						, SUM(CASE WHEN SO.TEAM_CD = 'KR6' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS CM1
						, SUM(CASE WHEN SO.TEAM_CD = 'KR7' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS CM2
						, SUM(CASE WHEN SO.TEAM_CD = 'KR8' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS CP
						, SUM(CASE WHEN SO.TEAM_CD = 'KR1' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS DM1
						, SUM(CASE WHEN SO.TEAM_CD = 'KR2' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS DM2
						, SUM(CASE WHEN SO.TEAM_CD = 'KR4' 
							THEN SF_ACCUM_SAP(IH.PROD_HIERARCHY, SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS GC
						, SUM(CASE WHEN SO.TEAM_CD = 'KR3' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS DP
					FROM O_SALESORDER SO
					LEFT JOIN O_ITEM_HEBE IH ON SO.ITEM_CD = IH.ITEM_CD 
					WHERE SO.ACTUAL_SHIP_DT = #{dt}
						AND SO.STATUS1 <![CDATA[<>]]> '980'
						AND SO.ORDERTY = 'OR'
						AND SO.PLANT_CD IS NOT NULL
						AND ( (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR (IH.PROD_HIERARCHY IN ('91170000', '91052105', '91052000')) )
					GROUP BY SO.PLANT_CD, IH.PROD_HIERARCHY, SO.PLANT_DESC, 
							(CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'BOARD'
									WHEN IH.PROD_HIERARCHY='91170000' THEN 'BOND'
									WHEN IH.PROD_HIERARCHY='91052105' THEN 'GYPTEX' ELSE '' END)
				) A  
				GROUP BY A.CATEG, A.UNIT
			)
		) XX
		ORDER BY XX.ACTUAL_SHIP_DT, XX.PLANT_CD, XX.CATEG
	</select>


	<select id="getShippedVolume" parameterType="hashmap" resultType="hashmap">
		SELECT XX.* FROM (
			(
				SELECT 
					A.ACTUAL_SHIP_DT
					, A.PLANT_CD
					, P.PT_NAME AS PLANT_NM
					, A.CATEG
					, A.UNIT
					, ROUND(SUM(A.ROUTE_513),0) AS ROUTE_513
					, ROUND(SUM(A.ROUTE_503),0) AS ROUTE_503
					, ROUND(SUM(A.SUMM),0) AS SUMM
					, ROUND(SUM(A.CM1),0) AS CM1
					, ROUND(SUM(A.CM2),0) AS CM2
					, ROUND(SUM(A.CP),0) AS CP
					, ROUND(SUM(A.DM1),0) AS DM1
					, ROUND(SUM(A.DM2),0) AS DM2
					, ROUND(SUM(A.GC),0) AS GC
					, ROUND(SUM(A.DP),0) AS DP
				FROM (
					SELECT SO.ACTUAL_SHIP_DT, SO.PLANT_CD 
						, (CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'BOARD'
								WHEN IH.PROD_HIERARCHY='91170000' THEN 'BOND'
								WHEN IH.PROD_HIERARCHY='91052105' THEN 'GYPTEX' ELSE '' END) AS CATEG
						, (CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'M2'
								WHEN IH.PROD_HIERARCHY='91170000' THEN 'KG'
								WHEN IH.PROD_HIERARCHY='91052105' THEN 'PAC' ELSE '' END) AS UNIT
						, SUM(CASE WHEN SO.ACTUAL_SHIP_DT=SO.REQUEST_DT 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS ROUTE_513
						, SUM(CASE WHEN SO.ACTUAL_SHIP_DT <![CDATA[<>]]> SO.REQUEST_DT 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS ROUTE_503
						, SUM(dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)) AS SUMM
						, SUM(CASE WHEN SO.TEAM_CD = 'KR6' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS CM1
						, SUM(CASE WHEN SO.TEAM_CD = 'KR7' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS CM2
						, SUM(CASE WHEN SO.TEAM_CD = 'KR8' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS CP
						, SUM(CASE WHEN SO.TEAM_CD = 'KR1' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS DM1
						, SUM(CASE WHEN SO.TEAM_CD = 'KR2' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS DM2
						, SUM(CASE WHEN SO.TEAM_CD = 'KR4' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS GC
						, SUM(CASE WHEN SO.TEAM_CD = 'KR3' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS DP
					FROM O_SALESORDER SO
					LEFT JOIN O_ITEM_HEBE IH ON SO.ITEM_CD = IH.ITEM_CD 
					WHERE SO.ACTUAL_SHIP_DT = #{dt}
						AND SO.STATUS1 <![CDATA[<>]]> '980'
						AND SO.ORDERTY = 'OR'
						AND SO.PLANT_CD IS NOT NULL
						AND ( (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR (IH.PROD_HIERARCHY IN ('91170000', '91052105', '91052000')) )
					GROUP BY SO.ACTUAL_SHIP_DT, SO.PLANT_CD, IH.PROD_HIERARCHY, SO.PLANT_DESC,
						(CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'BOARD'
								WHEN IH.PROD_HIERARCHY='91170000' THEN 'BOND'
								WHEN IH.PROD_HIERARCHY='91052105' THEN 'GYPTEX' ELSE '' END)
				) A 
				LEFT JOIN PLANT P ON P.WERKS = A.PLANT_CD
				GROUP BY A.ACTUAL_SHIP_DT, A.PLANT_CD, A.CATEG, A.UNIT, P.PT_NAME
			)
			UNION ALL 
			(
				SELECT 
					 '' AS ACTUAL_SHIP_DT
					, 'Total' AS PLANT_CD
					, '' AS PLANT_NM
					, A.CATEG
					, A.UNIT
					, ROUND(SUM(A.ROUTE_513),0) AS ROUTE_513
					, ROUND(SUM(A.ROUTE_503),0) AS ROUTE_503
					, ROUND(SUM(A.SUMM),0) AS SUMM
					, ROUND(SUM(A.CM1),0) AS CM1
					, ROUND(SUM(A.CM2),0) AS CM2
					, ROUND(SUM(A.CP),0) AS CP
					, ROUND(SUM(A.DM1),0) AS DM1
					, ROUND(SUM(A.DM2),0) AS DM2
					, ROUND(SUM(A.GC),0) AS GC
					, ROUND(SUM(A.DP),0) AS DP
				FROM (
					SELECT 
						(CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'BOARD'
									WHEN IH.PROD_HIERARCHY='91170000' THEN 'BOND'
									WHEN IH.PROD_HIERARCHY='91052105' THEN 'GYPTEX' ELSE '' END) AS CATEG
						, (CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'M2'
								WHEN IH.PROD_HIERARCHY='91170000' THEN 'KG'
								WHEN IH.PROD_HIERARCHY='91052105' THEN 'PAC' ELSE '' END) AS UNIT
								, ROUND(SUM(CASE WHEN SO.ACTUAL_SHIP_DT=SO.REQUEST_DT 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END),0) AS ROUTE_513
						, SUM(CASE WHEN SO.ACTUAL_SHIP_DT <![CDATA[<>]]> SO.REQUEST_DT 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS ROUTE_503
						, SUM(dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)) AS SUMM
						, SUM(CASE WHEN SO.TEAM_CD = 'KR6' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS CM1
						, SUM(CASE WHEN SO.TEAM_CD = 'KR7' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS CM2
						, SUM(CASE WHEN SO.TEAM_CD = 'KR8' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS CP
						, SUM(CASE WHEN SO.TEAM_CD = 'KR1' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS DM1
						, SUM(CASE WHEN SO.TEAM_CD = 'KR2' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS DM2
						, SUM(CASE WHEN SO.TEAM_CD = 'KR4' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY)
							ELSE 0 END) AS GC
						, SUM(CASE WHEN SO.TEAM_CD = 'KR3' 
							THEN dbo.SF_ACCUM_SAP(SO.ITEM_CD, SO.ORDER_QTY) 
							ELSE 0 END) AS DP
					FROM O_SALESORDER SO
					LEFT JOIN O_ITEM_HEBE IH ON SO.ITEM_CD = IH.ITEM_CD 
					WHERE SO.ACTUAL_SHIP_DT = #{dt}
						AND SO.STATUS1 <![CDATA[<>]]> '980'
						AND SO.ORDERTY = 'OR'
						AND SO.PLANT_CD IS NOT NULL
						AND ( (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR (IH.PROD_HIERARCHY IN ('91170000', '91052105', '91052000')) )
					GROUP BY SO.PLANT_CD, IH.PROD_HIERARCHY, SO.PLANT_DESC, 
							(CASE WHEN (IH.PROD_HIERARCHY BETWEEN '91000000' AND '91009999') OR IH.PROD_HIERARCHY = '91052000' THEN 'BOARD'
									WHEN IH.PROD_HIERARCHY='91170000' THEN 'BOND'
									WHEN IH.PROD_HIERARCHY='91052105' THEN 'GYPTEX' ELSE '' END)
				) A  
				GROUP BY A.CATEG, A.UNIT
			)
		) XX
		ORDER BY CASE WHEN XX.ACTUAL_SHIP_DT = '' THEN 999999999 ELSE XX.ACTUAL_SHIP_DT END, XX.PLANT_CD, XX.CATEG
	</select>



</mapper>