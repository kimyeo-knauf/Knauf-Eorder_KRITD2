<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="eorder.o_postalcode_sap">
	<select id="cnt" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) FROM O_POSTALCODE_SAP S
		<where>
			<if test="r_zipcd != null and r_zipcd != '' ">AND S.ZIP_CD = #{r_zipcd}</if>
			<if test="r_useflags != null">
				AND S.USE_F IN <foreach collection="r_useflags" item="use_flag" separator="," open="(" close=")">#{use_flag}</foreach>
			</if>
		</where> 
		
	</select>
	
	<select id="one" parameterType="hashmap" resultType="hashmap">
		SELECT S.ZIP_CD
			, S.ADDR
			, S.REF
			, 'EDIT' AS PROC_TYPE
			, S.USE_F
			, S.INSERT_DT
		FROM O_POSTALCODE_SAP S
		<where>
			<if test="r_zipcode != null and r_zipcode != '' ">AND S.ZIP_CD = #{r_zipcode}</if>
			<if test="r_useflags != null">
				AND S.USE_F IN <foreach collection="r_useflags" item="use_flag" separator="," open="(" close=")">#{use_flag}</foreach>
			</if>
		</where>
	</select>
	
	<select id="list" parameterType="hashmap" resultType="hashmap">
		SELECT * FROM (SELECT 
				ROW_NUMBER() OVER( ORDER BY ZIP_CD DESC ) AS ROWNUM
				, XX.* FROM (
			SELECT S.ZIP_CD
				, S.ADDR
				, S.REF
				, 'EDIT' AS PROC_TYPE
				, S.USE_F
				, S.INSERT_DT
			FROM O_POSTALCODE_SAP S
			<where>
				<if test="r_zipcode != null and r_zipcode != '' ">AND S.ZIP_CD LIKE '%' + #{r_zipcode} + '%'</if>
				<if test="r_useflags != null">
					AND S.USE_F IN <foreach collection="r_useflags" item="use_flag" separator="," open="(" close=")">#{use_flag}</foreach>
				</if>
			</where>
		) XX ) S
		<where>
			<if test="r_endrow != null and r_endrow != '' and r_startrow != null and r_startrow != ''" >	
				ROWNUM BETWEEN #{r_startrow} AND #{r_endrow}
			</if>
		</where>
	</select>
	
	<insert id="in" parameterType="hashmap">
		INSERT INTO O_POSTALCODE_SAP (
			ZIP_CD
			, ADDR
			, USE_F
			, INSERT_DT
			, REF
		) VALUES (
			#{r_zipcd}
			, #{r_addr}
			, #{r_usef}
			, SUBSTRING(CONVERT(CHAR(19), GETDATE(), 20), 1, 16)
			, #{r_ref}
		)
	</insert>
	
	<update id="up" parameterType="hashmap">
		UPDATE O_POSTALCODE_SAP
		<set>
			<if test="r_zipcd != null and r_zipcd != ''">ZIP_CD = #{r_zipcd},</if>
			<if test="r_addr != null and r_addr != ''">ADDR = #{r_addr},</if>
			<if test="r_usef != null and r_usef != ''">USE_F = #{r_usef},</if>
			<if test="r_ref != null and r_ref != ''">REF = #{r_ref},</if>
		</set>
		<where>
			AND ZIP_CD = #{r_zipcd}
		</where>
	</update>
</mapper>