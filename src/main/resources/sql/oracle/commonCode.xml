<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="eorder.commonCode">

	<insert id="in" parameterType="hashmap">
		INSERT INTO COMMONCODE (
			CC_CODE, CC_NAME, CC_PARENT
			, CC_DEPTH, CC_SORT1, CC_SORT2
			, CC_SORT3, CC_DESC, CC_USE
		) 
		VALUES (
			#{m_cccode, jdbcType=VARCHAR}, #{m_ccname, jdbcType=VARCHAR}, #{m_ccparent, jdbcType=VARCHAR}
			, #{m_ccdepth, jdbcType=NUMERIC}, #{m_ccsort1, jdbcType=NUMERIC}, #{m_ccsort2, jdbcType=NUMERIC}
			, #{m_ccsort3, jdbcType=NUMERIC}, #{m_ccdesc, jdbcType=VARCHAR}, #{m_ccuse, jdbcType=VARCHAR}
		)
	</insert>
	
	<update id="up" parameterType="hashmap">
		UPDATE COMMONCODE 
   		<set>
			<if test="m_ccname != null">CC_NAME = #{m_ccname},</if>
			<if test="m_ccsort1 != null">CC_SORT1 = #{m_ccsort1},</if>
			<if test="m_ccsort2 != null">CC_SORT2 = #{m_ccsort2},</if>
			<if test="m_ccsort3 != null">CC_SORT3 = #{m_ccsort3},</if>
			<if test="m_ccdesc != null">CC_DESC = #{m_ccdesc},</if>
			<if test="m_ccuse != null">CC_USE = #{m_ccuse},</if>
		</set>
	    <where>
	    	AND CC_CODE = #{r_cccode}
	    </where>
	</update>

	<update id="upArr" parameterType="hashmap">
		UPDATE COMMONCODE 
   		<set>
			<if test="m_ccname != null">CC_NAME = #{m_ccname},</if>
			<if test="m_ccsort1 != null">CC_SORT1 = #{m_ccsort1},</if>
			<if test="m_ccsort2 != null">CC_SORT2 = #{m_ccsort2},</if>
			<if test="m_ccsort3 != null">CC_SORT3 = #{m_ccsort3},</if>
			<if test="m_ccdesc != null">CC_DESC = #{m_ccdesc},</if>
			<if test="m_ccuse != null">CC_USE = #{m_ccuse},</if>
		</set>
	    <where>
	    	AND CC_CODE IN <foreach collection="ri_cccode" item="cc_code" separator="," open="(" close=")">#{ cc_code }</foreach>
	    </where>
	</update>
	
	<select id="list" parameterType="hashmap" resultType="hashmap">
		SELECT * FROM (SELECT ROWNUM RR, XX.* FROM (
	
		SELECT CC.*
			, (SELECT COUNT(*) FROM COMMONCODE WHERE CC_PARENT = CC.CC_CODE) CHILD_COUNT
		FROM COMMONCODE CC
		<where>
			<if test="r_ccparent != null">AND NVL(CC_PARENT, ' ') =  NVL(#{r_ccparent}, ' ')</if>
			<if test="r_ccuse != null and r_ccuse != ''">AND CC_USE = #{r_ccuse}</if>
			<if test="rl_name_code != null and rl_name_code != ''">
				AND (CC_NAME LIKE '%' || #{rl_userid} || '%' OR CC_CODE LIKE '%' || #{rl_userid} || '%')
			</if>
		</where> 
		 
		ORDER BY CC_SORT1, CC_SORT2, CC_SORT3
		) XX 
		<where>
			<if test="r_endrow != null and r_endrow != ''"><![CDATA[ROWNUM <= #{r_endrow}]]></if>		
		</where> )
		<where>
			<if test="r_startrow != null and r_startrow != ''"><![CDATA[RR >= #{r_startrow}]]></if>
		</where>
	</select>
	
	<select id="list2" parameterType="hashmap" resultType="hashmap">
		SELECT * FROM (SELECT ROWNUM RR, XX.* FROM (
	
		SELECT CC.*
		FROM COMMONCODE CC
		<where>
			<if test="r_ccparent != null and r_ccparent != ''">AND CC_PARENT = #{r_ccparent}</if>
			<if test="r_ccuse != null and r_ccuse != ''">AND CC_USE = #{r_ccuse}</if>
			<if test="rl_name_code != null and rl_name_code != ''">
				AND (CC_NAME LIKE '%' || #{rl_userid} || '%' OR CC_CODE LIKE '%' || #{rl_userid} || '%')
			</if>
			
		</where> 
		 
		ORDER BY CC_SORT1, CC_SORT2, CC_SORT3
		) XX 
		<where>
			<if test="r_endrow != null and r_endrow != ''"><![CDATA[ROWNUM <= #{r_endrow}]]></if>		
		</where> )
		<where>
			<if test="r_startrow != null and r_startrow != ''"><![CDATA[RR >= #{r_startrow}]]></if>
		</where>
	</select>

	<select id="one" parameterType="hashmap" resultType="hashmap">
		SELECT * FROM COMMONCODE WHERE CC_CODE = #{r_cccode}
	</select>
	
	<select id="maxCode" parameterType="hashmap" resultType="int">
		SELECT TO_NUMBER(NVL(MAX(SUBSTR(CC_CODE, (3 * #{r_ccdepth})-1)), '0')) + 1 
		FROM COMMONCODE 
		<where>
			AND NVL(CC_PARENT, ' ') =  NVL(#{r_ccparent}, ' ')
		</where> 
	</select>
	
	<select id="maxCodeForC01" parameterType="hashmap" resultType="int">
		SELECT TO_NUMBER(NVL(MAX(CC_CODE), '0')) + 1 
		FROM COMMONCODE 
		<where>
			AND NVL(CC_PARENT, ' ') =  NVL('C01', ' ')
		</where> 
	</select>
	
	<select id="maxSort" parameterType="hashmap" resultType="int">
		SELECT 
			<if test='1 == r_ccdepth'>NVL(MAX(CC_SORT1), 0) + 1</if>
			<if test='2 == r_ccdepth'>NVL(MAX(CC_SORT2), 0) + 1</if>
			<if test='3 == r_ccdepth'>NVL(MAX(CC_SORT3), 0) + 1</if>
		FROM COMMONCODE 
		<where>
			AND NVL(CC_PARENT, ' ') = NVL(#{r_ccparent}, ' ')
		</where> 
	</select>
	
	<select id="getCategoryListWithDepth" parameterType="hashmap" resultType="hashmap">
		SELECT c.CC_CODE, c.CC_NAME FROM COMMONCODE c
		WHERE c.CC_CODE LIKE '' || #{r_cccode} || '%' 
		AND c.CC_DEPTH = #{r_depth}
		ORDER BY c.CC_CODE
	</select>
	
</mapper>