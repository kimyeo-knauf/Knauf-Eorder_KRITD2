<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="eorder.o_salesorder">

	<select id="one" parameterType="hashmap" resultType="hashmap">
		SELECT 
			SO.ORDERNO, SO.ORDERTY, SO.LINE_NO, SO.ORDER_DT, SO.REQUEST_DT, SO.ACTUAL_SHIP_DT, SO.CUST_CD, SO.CUST_NM, SO.SHIPTO_CD, SO.SHIPTO_NM
        	, SO.ADD1, SO.ADD2, SO.ADD4, SO.ZIP_CD, SO.COMPANY, SO.PLANT_CD, SO.PLANT_DESC, SO.ITEM_CD, SO.ITEM_DESC, SO.ORDER_QTY, SO.UNIT, SO.PRIMARY_QTY
        	, SO.UNIT1, SO.SECOND_QTY, SO.UNIT2, SO.WEIGHT, SO.WEIGHT_UNIT, SO.AMOUNT, SO.STATUS1, SO.STATUS2, SO.STATUS_DESC, SO.DRIVER_PHONE
        	, SO.SHIPMENT_CD_3PL, SO.CUST_PO, SO.ORDER_TAKER, SO.HOLD_CODE, SO.TRUCK_NO, SO.SALESREP_CD, SO.SALESREP_NM, SO.TEAM_CD, SO.TEAM_NM, SO.BUILDING_TYPE, SO.INSERT_DT
        	, SO.PRICE, SO.ADD3, SO.REQUEST_TIME, SO.DUMMY
			<!-- ,(SELECT B.REQUEST_TIME FROM O_ORDER_CONFIRM_H B WHERE B.CUST_PO=TRIM(SO.CUST_PO))AS DUMMY -->
			<!-- ,DECODE(SO.REQUEST_TIME,'',' ',SUBSTR(SO.REQUEST_TIME,0,2)||':'||SUBSTR(SO.REQUEST_TIME,3,2)) AS REQUEST_TIME -->
		FROM O_SALESORDER SO
		<where>
			<if test="wherebody_status != null and wherebody_status != '' ">
				${wherebody_status}
			</if>
			<if test="r_ordersdt != null and r_ordersdt != '' ">AND SO.ORDER_DT <![CDATA[>=]]> #{r_ordersdt}</if>
			<if test="r_orderedt != null and r_orderedt != '' ">AND SO.ORDER_DT <![CDATA[<=]]> #{r_orderedt}</if>
			<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
			<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
			<if test="rl_orderno != null and rl_orderno != '' ">AND SO.ORDERNO LIKE '%' || #{rl_orderno} || '%'</if> <!-- 오더번호 -->
			<if test="rl_custpo != null and rl_custpo != '' ">AND SO.CUST_PO LIKE '%' || #{rl_custpo} || '%'</if> <!-- 고객주문번호 -->
			<if test="rl_itemdesc != null and rl_itemdesc != '' ">AND SO.ITEM_DESC LIKE '%' || #{rl_itemdesc} || '%'</if> 
			<if test="rl_receiver != null and rl_receiver != '' ">AND SO.RECEIVER LIKE '%' || #{rl_receiver} || '%'</if>
			<if test="r_custcd != null and r_custcd != '' ">AND SO.CUST_CD = #{r_custcd}</if>
			<if test="r_shiptocd != null and r_shiptocd != '' ">AND SO.SHIPTO_CD = #{r_shiptocd}</if>
			<if test="rl_add1 != null and rl_add1 != '' ">AND (SO.ADD1 || SO.ADD2) LIKE '%' || #{rl_add1} || '%'</if>
			<if test="rl_shiptocd != null and rl_shiptocd != '' ">AND SO.SHIPTO_CD LIKE '%' || #{rl_shiptocd} || '%'</if>
			<if test="rl_shiptonm != null and rl_shiptonm != '' ">AND SO.SHIPTO_NM LIKE '%' || #{rl_shiptonm} || '%'</if>
			<if test="rl_salesrepnm != null and rl_salesrepnm != '' ">AND SO.SALESREP_NM LIKE '%' || #{rl_salesrepnm} || '%'</if>
			<if test="r_orderno != null and r_orderno != '' ">AND SO.ORDERNO = #{r_orderno}</if>
			<if test="r_orderty != null and r_orderty != '' ">AND SO.ORDERTY = #{r_orderty}</if>
			<if test="r_lineno != null and r_lineno != '' ">AND SO.LINE_NO = #{r_lineno}</if>
		</where>
	</select>
	
	<select id="cnt" parameterType="hashmap" resultType="int">
		SELECT COUNT(*)
		FROM O_SALESORDER SO
		<where>
			<if test="wherebody_status != null and wherebody_status != '' ">
				${wherebody_status}
			</if>
			<if test="r_ordersdt != null and r_ordersdt != '' ">AND SO.ORDER_DT <![CDATA[>=]]> #{r_ordersdt}</if>
			<if test="r_orderedt != null and r_orderedt != '' ">AND SO.ORDER_DT <![CDATA[<=]]> #{r_orderedt}</if>
			<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
			<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
			<if test="r_requestsdt != null and r_requestsdt != '' ">AND SO.REQUEST_DT <![CDATA[>=]]> #{r_requestsdt}</if>
			<if test="r_requestedt != null and r_requestedt != '' ">AND SO.REQUEST_DT <![CDATA[<=]]> #{r_requestedt}</if>
			<if test="r_orderno != null and r_orderno != '' ">AND SO.ORDERNO = #{r_orderno}</if>
			<if test="rl_orderno != null and rl_orderno != '' ">AND SO.ORDERNO LIKE '%' || #{rl_orderno} || '%'</if> <!-- 오더번호 -->
			<if test="rl_custpo != null and rl_custpo != '' ">AND SO.CUST_PO LIKE '%' || #{rl_custpo} || '%'</if> <!-- 고객주문번호 -->
			<if test="r_truckno != null and r_truckno != '' ">AND SO.TRUCK_NO = #{r_truckno}</if>
			<if test="rl_itemdesc != null and rl_itemdesc != '' ">AND SO.ITEM_DESC LIKE '%' || #{rl_itemdesc} || '%'</if> 
			<if test="rl_receiver != null and rl_receiver != '' ">AND SO.RECEIVER LIKE '%' || #{rl_receiver} || '%'</if>
			<if test="r_custcd != null and r_custcd != '' ">AND SO.CUST_CD = #{r_custcd}</if> 
			<if test="r_shiptocd != null and r_shiptocd != '' ">AND SO.SHIPTO_CD = #{r_shiptocd}</if>
			<!-- <if test="rl_shiptocd != null and rl_shiptocd != '' ">AND SO.SHIPTO_CD LIKE '%' || #{rl_shiptocd} || '%'</if>
			<if test="rl_shiptonm != null and rl_shiptonm != '' ">AND SO.SHIPTO_NM LIKE '%' || #{rl_shiptonm} || '%'</if> -->
			<if test="rl_shiptonm != null and rl_shiptonm != '' ">AND SO.SHIPTO_NM = #{rl_shiptonm}</if>

			<if test="rl_add1 != null and rl_add1 != '' ">AND (SO.ADD1 || SO.ADD2) LIKE '%' || #{rl_add1} || '%'</if>
			<!-- <if test="rl_salesrepnm != null and rl_salesrepnm != '' ">
				AND SO.CUST_CD IN (SELECT CUST_CD FROM O_CUSTOMER WHERE SALESREP_NM LIKE '%' || #{rl_salesrepnm} || '%')
			</if> -->
			<if test="rl_salesrepid != null and rl_salesrepid != '' ">
				AND SO.SALESREP_CD = #{rl_salesrepid}
			</if>
			<if test="r_insertsdt != null and r_insertsdt != '' ">AND SO.INSERT_DT <![CDATA[>=]]> #{r_insertsdt}</if>
			<if test="r_insertedt != null and r_insertedt != '' ">AND SO.INSERT_DT <![CDATA[<=]]> #{r_insertedt}</if>
			<if test="rl_ordertp != null and rl_ordertp != ''">AND UPPER(SO.ORDERTY) = UPPER(#{rl_ordertp})</if>
			<!-- 관리자 권한에 따른 조건절 -->
 			<if test="r_adminauthority != null and r_adminauthority != '' ">
 				<if test='"AD".equals(r_adminauthority)'>
 				</if>
 				<if test='"CS".equals(r_adminauthority)'>
 					AND SO.SALESREP_CD IN (SELECT SALESUSERID FROM O_CSSALESMAP WHERE CSUSERID = #{r_adminuserid})
 				</if>
 				<if test='"SH".equals(r_adminauthority) or "SM".equals(r_adminauthority) or "SR".equals(r_adminauthority)'>
 					<if test='"SH".equals(r_adminauthority)'>
 						AND SO.SALESREP_CD IN (SELECT USERID FROM O_USER WHERE USER_CATE2 = #{r_adminuserid})
 					</if>
 					<if test='"SM".equals(r_adminauthority)'>
 						AND SO.SALESREP_CD IN (SELECT USERID FROM O_USER WHERE USER_CATE3 = #{r_adminuserid})
 					</if>
 					<if test='"SR".equals(r_adminauthority)'>
 						AND SO.SALESREP_CD = #{r_adminuserid}
 					</if>
 				</if>
 				<if test='"MK".equals(r_adminauthority)'>
 					
 				</if>
 			</if>
 			<!-- End. -->
		</where>
	</select>
	
	<select id="list" parameterType="hashmap" resultType="hashmap">
		SELECT * FROM (SELECT ROWNUM RR, XX.* FROM (
		
		SELECT 
			SO.ORDERNO, SO.ORDERTY, SO.LINE_NO, SO.ORDER_DT, SO.REQUEST_DT, SO.ACTUAL_SHIP_DT, SO.CUST_CD, SO.CUST_NM, SO.SHIPTO_CD, SO.SHIPTO_NM
        	, SO.ADD1, SO.ADD2, SO.ADD4, SO.ZIP_CD, SO.COMPANY, SO.PLANT_CD, SO.PLANT_DESC, SO.ITEM_CD, SO.ITEM_DESC, SO.ORDER_QTY, SO.UNIT
        	, (CASE WHEN SO.STATUS1 = '980' 
				THEN 0
				ELSE (
					CASE WHEN OH.ITEM_CD IS NOT NULL 
					THEN SO.PRIMARY_QTY * OH.X / OH.Y
					ELSE SO.PRIMARY_QTY
					END
				) END) AS PRIMARY_QTY
        	, (CASE WHEN OH.HEBE_UM IS NULL THEN (SELECT DISTINCT UNIT FROM O_SALESORDER WHERE ITEM_DESC = SO.ITEM_DESC) ELSE OH.HEBE_UM END) AS UNIT1
        	, SO.SECOND_QTY, SO.UNIT2, SO.WEIGHT, SO.WEIGHT_UNIT, SO.AMOUNT, SO.STATUS1, SO.STATUS2
        	<!-- , SO.STATUS_DESC  -->
        	, CASE 
				WHEN (SO.STATUS1=580 AND SO.STATUS2=620 AND SO.REQUEST_DT <![CDATA[<]]> TO_CHAR(SYSDATE, 'yyyymmdd')) THEN '배송완료'
				<!-- WHEN (SO.STATUS1=580 AND SO.STATUS2=620) AND SO.REQUEST_DT <![CDATA[>=]]> TO_CHAR(SYSDATE, 'yyyymmdd') THEN '출하완료' -->
				WHEN (SO.STATUS1 >= 580 AND SO.STATUS1 <![CDATA[<>]]> '980' AND SO.STATUS2 = 620 AND SO.REQUEST_DT >= TO_CHAR(SYSDATE, 'yyyymmdd')) THEN '출하완료'
				ELSE SO.STATUS_DESC END AS STATUS_DESC
        	, SO.DRIVER_PHONE, SO.SHIPMENT_CD_3PL, SO.CUST_PO, SO.ORDER_TAKER, SO.HOLD_CODE, SO.TRUCK_NO, SO.SALESREP_CD, SO.SALESREP_NM
        	, SO.TEAM_CD, SO.TEAM_NM, SO.BUILDING_TYPE, SO.INSERT_DT, SO.PRICE, SO.ADD3, SO.REQUEST_TIME, SO.DUMMY
			<!-- ,(SELECT B.REQUEST_TIME FROM O_ORDER_CONFIRM_H B WHERE B.CUST_PO=TRIM(SO.CUST_PO))AS DUMMY -->
			<!-- ,DECODE(SO.REQUEST_TIME,'',' ',SUBSTR(SO.REQUEST_TIME,0,2)||':'||SUBSTR(SO.REQUEST_TIME,3,2)) AS REQUEST_TIME -->
		FROM O_SALESORDER SO
		LEFT JOIN O_ITEM_HEBE OH ON SO.ITEM_CD = OH.ITEM_CD
		<where>
			<if test="wherebody_status != null and wherebody_status != '' ">
				${wherebody_status}
			</if>
			<if test="r_ordersdt != null and r_ordersdt != '' ">AND SO.ORDER_DT <![CDATA[>=]]> #{r_ordersdt}</if>
			<if test="r_orderedt != null and r_orderedt != '' ">AND SO.ORDER_DT <![CDATA[<=]]> #{r_orderedt}</if>
			<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
			<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
			<if test="r_requestsdt != null and r_requestsdt != '' ">AND SO.REQUEST_DT <![CDATA[>=]]> #{r_requestsdt}</if>
			<if test="r_requestedt != null and r_requestedt != '' ">AND SO.REQUEST_DT <![CDATA[<=]]> #{r_requestedt}</if>
			<if test="r_orderno != null and r_orderno != '' ">AND SO.ORDERNO = #{r_orderno}</if>
			<if test="rl_orderno != null and rl_orderno != '' ">AND SO.ORDERNO LIKE '%' || #{rl_orderno} || '%'</if> <!-- 오더번호 -->
			<if test="rl_custpo != null and rl_custpo != '' ">AND SO.CUST_PO LIKE '%' || #{rl_custpo} || '%'</if> <!-- 고객주문번호 -->
			<if test="rl_itemdesc != null and rl_itemdesc != '' ">AND SO.ITEM_DESC LIKE '%' || #{rl_itemdesc} || '%'</if> <!-- 품목명 -->
			<if test="r_salescd1nm != null and r_salescd1nm != '' ">
				AND SO.ITEM_CD IN ( SELECT ITEM_CD FROM O_ITEM_NEW WHERE SALES_CD1_NM = #{r_salescd1nm} )
			</if> <!-- 품목분류 코드1 -->
			<if test="r_salescd2nm != null and r_salescd2nm != '' ">
				AND SO.ITEM_CD IN ( SELECT ITEM_CD FROM O_ITEM_NEW WHERE SALES_CD2_NM = #{r_salescd2nm} )
			</if> <!-- 품목분류 코드2 -->
			<if test="r_salescd3nm != null and r_salescd3nm != '' ">
				AND SO.ITEM_CD IN ( SELECT ITEM_CD FROM O_ITEM_NEW WHERE SALES_CD3_NM = #{r_salescd3nm} )
			</if> <!-- 품목분류 코드3 -->
			<if test="rl_receiver != null and rl_receiver != '' ">AND SO.RECEIVER LIKE '%' || #{rl_receiver} || '%'</if> 
			<if test="r_custcd != null and r_custcd != '' ">AND SO.CUST_CD = #{r_custcd}</if>
			<if test="r_truckno != null and r_truckno != '' ">AND SO.TRUCK_NO = #{r_truckno}</if>
			<if test="rl_itemdesc != null and rl_itemdesc != '' ">AND SO.ITEM_DESC LIKE '%' || #{rl_itemdesc} || '%'</if> 
			<if test="rl_receiver != null and rl_receiver != '' ">AND SO.RECEIVER LIKE '%' || #{rl_receiver} || '%'</if>
			<if test="r_shiptocd != null and r_shiptocd != '' ">AND SO.SHIPTO_CD = #{r_shiptocd}</if>
			<!-- <if test="rl_shiptocd != null and rl_shiptocd != '' ">AND SO.SHIPTO_CD LIKE '%' || #{rl_shiptocd} || '%'</if> 
			<if test="rl_shiptonm != null and rl_shiptonm != '' ">AND SO.SHIPTO_NM LIKE '%' || #{rl_shiptonm} || '%'</if> -->
			<if test="rl_shiptonm != null and rl_shiptonm != '' ">AND SO.SHIPTO_NM = #{rl_shiptonm}</if>
			
			<!-- <if test="rl_salesrepnm != null and rl_salesrepnm != '' ">
				AND SO.CUST_CD IN (SELECT CUST_CD FROM O_CUSTOMER WHERE SALESREP_NM LIKE '%' || #{rl_salesrepnm} || '%')
			</if> --> 
			<if test="rl_salesrepid != null and rl_salesrepid != '' ">
				AND SO.SALESREP_CD = #{rl_salesrepid}
			</if>
			<if test="rl_add1 != null and rl_add1 != '' ">AND (SO.ADD1 || SO.ADD2) LIKE '%' || #{rl_add1} || '%'</if>
			<if test="r_insertsdt != null and r_insertsdt != '' ">AND SO.INSERT_DT <![CDATA[>=]]> #{r_insertsdt}</if>
			<if test="r_insertedt != null and r_insertedt != '' ">AND SO.INSERT_DT <![CDATA[<=]]> #{r_insertedt}</if>
			<if test="rl_ordertp != null and rl_ordertp != ''">AND UPPER(SO.ORDERTY) = UPPER(#{rl_ordertp})</if>
			<!-- 관리자 권한에 따른 조건절 -->
 			<if test="r_adminauthority != null and r_adminauthority != '' ">
 				<if test='"AD".equals(r_adminauthority)'>
 				</if>
 				<if test='"CS".equals(r_adminauthority)'>
 					AND SO.SALESREP_CD IN (SELECT SALESUSERID FROM O_CSSALESMAP WHERE CSUSERID = #{r_adminuserid})
 				</if>
 				<if test='"SH".equals(r_adminauthority) or "SM".equals(r_adminauthority) or "SR".equals(r_adminauthority)'>
 					<if test='"SH".equals(r_adminauthority)'>
 						AND SO.SALESREP_CD IN (SELECT USERID FROM O_USER WHERE USER_CATE2 = #{r_adminuserid})
 					</if>
 					<if test='"SM".equals(r_adminauthority)'>
 						AND SO.SALESREP_CD IN (SELECT USERID FROM O_USER WHERE USER_CATE3 = #{r_adminuserid})
 					</if>
 					<if test='"SR".equals(r_adminauthority)'>
 						AND SO.SALESREP_CD = #{r_adminuserid}
 					</if>
 				</if>
 				<if test='"MK".equals(r_adminauthority)'>
 					
 				</if>
 			</if>
 			<!-- End. -->
		</where>
		
		<if test=" r_orderby != null and r_orderby != '' ">ORDER BY ${r_orderby}</if>
		) XX 
		<where>
			<if test="r_endrow != null and r_endrow != ''"><![CDATA[ROWNUM <= #{r_endrow}]]></if>		
		</where> )
		<where>
			<if test="r_startrow != null and r_startrow != ''"><![CDATA[RR >= #{r_startrow}]]></if>
		</where>
	</select>
	
	<select id="cntGroup" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) FROM(
		
		SELECT ORDERNO
		FROM O_SALESORDER SO
		<where>
			<if test="wherebody_status != null and wherebody_status != '' ">
				${wherebody_status}
			</if>
			<if test="r_ordersdt != null and r_ordersdt != '' ">AND SO.ORDER_DT <![CDATA[>=]]> #{r_ordersdt}</if>
			<if test="r_orderedt != null and r_orderedt != '' ">AND SO.ORDER_DT <![CDATA[<=]]> #{r_orderedt}</if>
			<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
			<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
			<if test="r_orderno != null and r_orderno != '' ">AND SO.ORDERNO = #{r_orderno}</if>
			<if test="rl_orderno != null and rl_orderno != '' ">AND SO.ORDERNO LIKE '%' || #{rl_orderno} || '%'</if> <!-- 오더번호 -->
			<if test="rl_custpo != null and rl_custpo != '' ">AND SO.CUST_PO LIKE '%' || #{rl_custpo} || '%'</if> <!-- 고객주문번호 -->
			<if test="rl_itemdesc != null and rl_itemdesc != '' ">AND SO.ITEM_DESC LIKE '%' || #{rl_itemdesc} || '%'</if> 
			<if test="rl_receiver != null and rl_receiver != '' ">AND SO.RECEIVER LIKE '%' || #{rl_receiver} || '%'</if> 
			<if test="r_custcd != null and r_custcd != '' ">AND SO.CUST_CD = #{r_custcd}</if>
			<if test="r_shiptocd != null and r_shiptocd != '' ">AND SO.SHIPTO_CD = #{r_shiptocd}</if>
			<if test="rl_shiptocd != null and rl_shiptocd != '' ">AND SO.SHIPTO_CD LIKE '%' || #{rl_shiptocd} || '%'</if>
			<if test="rl_shiptonm != null and rl_shiptonm != '' ">AND SO.SHIPTO_NM LIKE '%' || #{rl_shiptonm} || '%'</if>
			<if test="rl_salesrepnm != null and rl_salesrepnm != '' ">
				AND SO.CUST_CD IN (SELECT CUST_CD FROM O_CUSTOMER WHERE SALESREP_NM LIKE '%' || #{rl_salesrepnm} || '%')
				<!-- AND SO.SALESREP_NM LIKE '%' || #{rl_salesrepnm} || '%' -->
			</if>
			<if test="rl_add1 != null and rl_add1 != '' ">AND SO.ADD1 LIKE '%' || #{rl_add1} || '%'</if>
			
			<if test="r_insertsdt != null and r_insertsdt != '' ">AND SO.INSERT_DT <![CDATA[>=]]> #{r_insertsdt}</if>
			<if test="r_insertedt != null and r_insertedt != '' ">AND SO.INSERT_DT <![CDATA[<=]]> #{r_insertedt}</if>
			<!-- 관리자 권한에 따른 조건절 -->
 			<if test="r_adminauthority != null and r_adminauthority != '' ">
 				<if test='"AD".equals(r_adminauthority)'>
 				</if>
 				<if test='"CS".equals(r_adminauthority)'>
 					AND SO.SALESREP_CD IN (SELECT SALESUSERID FROM O_CSSALESMAP WHERE CSUSERID = #{r_adminuserid})
 				</if>
 				<if test='"SH".equals(r_adminauthority) or "SM".equals(r_adminauthority) or "SR".equals(r_adminauthority)'>
 					<if test='"SH".equals(r_adminauthority)'>
 						AND SO.SALESREP_CD IN (SELECT USERID FROM O_USER WHERE USER_CATE2 = #{r_adminuserid})
 					</if>
 					<if test='"SM".equals(r_adminauthority)'>
 						AND SO.SALESREP_CD IN (SELECT USERID FROM O_USER WHERE USER_CATE3 = #{r_adminuserid})
 					</if>
 					<if test='"SR".equals(r_adminauthority)'>
 						AND SO.SALESREP_CD = #{r_adminuserid}
 					</if>
 				</if>
 				<if test='"MK".equals(r_adminauthority)'>
 					
 				</if>
 			</if>
		</where>
		GROUP BY ORDERNO
		
		) ORDN
	</select>
	
	<select id="cntForItem" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) FROM (
		
		SELECT ITEM_DESC, UNIT
		FROM O_SALESORDER SO
		<where>
			<if test="wherebody_status != null and wherebody_status != '' ">
				${wherebody_status}
			</if>
			<if test="r_ordersdt != null and r_ordersdt != '' ">AND SO.ORDER_DT <![CDATA[>=]]> #{r_ordersdt}</if>
			<if test="r_orderedt != null and r_orderedt != '' ">AND SO.ORDER_DT <![CDATA[<=]]> #{r_orderedt}</if>
			<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
			<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
			<if test="rl_orderno != null and rl_orderno != '' ">AND SO.ORDERNO LIKE '%' || #{rl_orderno} || '%'</if> <!-- 오더번호 -->
			<if test="rl_custpo != null and rl_custpo != '' ">AND SO.CUST_PO LIKE '%' || #{rl_custpo} || '%'</if> <!-- 고객주문번호 -->
			<if test="rl_itemdesc != null and rl_itemdesc != '' ">AND SO.ITEM_DESC LIKE '%' || #{rl_itemdesc} || '%'</if> 
			<if test="rl_receiver != null and rl_receiver != '' ">AND SO.RECEIVER LIKE '%' || #{rl_receiver} || '%'</if>
			<if test="r_custcd != null and r_custcd != '' ">AND SO.CUST_CD = #{r_custcd}</if> 
			<if test="r_shiptocd != null and r_shiptocd != '' ">AND SO.SHIPTO_CD = #{r_shiptocd}</if>
			<if test="rl_shiptocd != null and rl_shiptocd != '' ">AND SO.SHIPTO_CD LIKE '%' || #{rl_shiptocd} || '%'</if>
			<if test="rl_shiptonm != null and rl_shiptonm != '' ">AND SO.SHIPTO_NM LIKE '%' || #{rl_shiptonm} || '%'</if>
			<if test="rl_salesrepnm != null and rl_salesrepnm != '' ">AND SO.SALESREP_NM LIKE '%' || #{rl_salesrepnm} || '%'</if>
		</where>
		GROUP BY SO.ITEM_DESC, SO.UNIT
		
		)
	</select>
	
	<select id="listForItem" parameterType="hashmap" resultType="hashmap">
		SELECT * FROM (SELECT ROWNUM RR, XX.* FROM (
		
		SELECT 
			ITEM_DESC, UNIT
			, SUM(ORDER_QTY) AS ORDER_QTY
		FROM O_SALESORDER SO
		<where>
			<if test="wherebody_status != null and wherebody_status != '' ">
				${wherebody_status}
			</if>
			<if test="r_ordersdt != null and r_ordersdt != '' ">AND SO.ORDER_DT <![CDATA[>=]]> #{r_ordersdt}</if>
			<if test="r_orderedt != null and r_orderedt != '' ">AND SO.ORDER_DT <![CDATA[<=]]> #{r_orderedt}</if>
			<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
			<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND SO.ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
			<if test="rl_orderno != null and rl_orderno != '' ">AND SO.ORDERNO LIKE '%' || #{rl_orderno} || '%'</if> <!-- 오더번호 -->
			<if test="rl_custpo != null and rl_custpo != '' ">AND SO.CUST_PO LIKE '%' || #{rl_custpo} || '%'</if> <!-- 고객주문번호 -->
			<if test="rl_itemdesc != null and rl_itemdesc != '' ">AND SO.ITEM_DESC LIKE '%' || #{rl_itemdesc} || '%'</if> 
			<if test="rl_receiver != null and rl_receiver != '' ">AND SO.RECEIVER LIKE '%' || #{rl_receiver} || '%'</if>
			<if test="r_custcd != null and r_custcd != '' ">AND SO.CUST_CD = #{r_custcd}</if> 
			<if test="r_shiptocd != null and r_shiptocd != '' ">AND SO.SHIPTO_CD = #{r_shiptocd}</if>
			<if test="rl_shiptocd != null and rl_shiptocd != '' ">AND SO.SHIPTO_CD LIKE '%' || #{rl_shiptocd} || '%'</if>
			<if test="rl_shiptonm != null and rl_shiptonm != '' ">AND SO.SHIPTO_NM LIKE '%' || #{rl_shiptonm} || '%'</if>
			<if test="rl_salesrepnm != null and rl_salesrepnm != '' ">AND SO.SALESREP_NM LIKE '%' || #{rl_salesrepnm} || '%'</if>
		</where>
		GROUP BY SO.ITEM_DESC, SO.UNIT
		
		<if test=" r_orderby != null and r_orderby != '' ">ORDER BY ${r_orderby}</if>
		) XX 
		<where>
			<if test="r_endrow != null and r_endrow != ''"><![CDATA[ROWNUM <= #{r_endrow}]]></if>		
		</where> )
		<where>
			<if test="r_startrow != null and r_startrow != ''"><![CDATA[RR >= #{r_startrow}]]></if>
		</where>
	</select>
	
	<select id="getOrderNoGroup" parameterType="hashmap" resultType="hashmap">
		SELECT ORDERNO, CUST_CD, TRUCK_NO
		FROM O_SALESORDER  
		<where>
			<if test="ri_orderno != null">
   				AND ORDERNO IN <foreach collection="ri_orderno" item="order_no" separator="," open="(" close=")">#{order_no}</foreach>
   			</if>
   			<if test=" r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if>
		</where>
		GROUP BY ORDERNO, CUST_CD, TRUCK_NO
	</select>
	
	<!-- Start. 납품확인서 리스트 -->
	<select id="getOrderShipGroup" parameterType="hashmap" resultType="hashmap">
		SELECT SHIPTO_CD
		FROM O_SALESORDER  
		<where>
			<if test=" r_wherebody != null and r_wherebody != '' ">AND ${r_wherebody}</if>
		</where>
		GROUP BY SHIPTO_CD
	</select>
	
	<select id="getOrderShipNmGroup" parameterType="hashmap" resultType="hashmap">
		<!-- SELECT SO.SHIPTO_CD, ST.SHIPTO_NM FROM(
		
			SELECT SHIPTO_CD
			FROM O_SALESORDER  
			<where>
				<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
				<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
				<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
			</where>
			GROUP BY SHIPTO_CD
			
		) SO
		LEFT JOIN O_SHIPTO ST ON SO.SHIPTO_CD = ST.SHIPTO_CD
		ORDER BY SO.SHIPTO_CD ASC -->
		
		SELECT
			'' AS SHIPTO_CD,
			SHIPTO_NM
		FROM
			O_SALESORDER
		<where>
				ORDERTY <![CDATA[<>]]> 'KL'
				AND STATUS2 IN (522, 525, 527, 530, 560, 580, 620)
				<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
				<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
				<if test="r_ordersdt != null and r_ordersdt != '' ">AND ORDER_DT <![CDATA[>=]]> #{r_ordersdt}</if>
				<if test="r_orderedt != null and r_orderedt != '' ">AND ORDER_DT <![CDATA[<=]]> #{r_orderedt}</if>
				<if test="r_requestsdt != null and r_requestsdt != '' ">AND REQUEST_DT <![CDATA[>=]]> #{r_requestsdt}</if>
				<if test="r_requestedt != null and r_requestedt != '' ">AND REQUEST_DT <![CDATA[<=]]> #{r_requestedt}</if>
				
				<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
			</where>
		GROUP BY
			SHIPTO_NM
		ORDER BY SHIPTO_NM ASC
	</select>
	
	<!-- 
	<select id="getOrderItemGroupItem" parameterType="hashmap" resultType="hashmap">
		SELECT ITEM_DESC
		FROM O_SALESORDER  
		<where>
			<if test=" r_wherebody != null and r_wherebody != '' ">AND ${r_wherebody}</if>
			<if test=" r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if>
			<if test=" r_add1 != null and r_add1 != '' ">AND ADD1 = #{r_add1}</if>
		</where>
		GROUP BY ITEM_DESC
	</select>
	 -->
	
	<select id="getCntReportFor1020" parameterType="hashmap" resultType="int">
		SELECT COUNT(*)
		FROM ( 
		
			SELECT SO.ACTUAL_SHIP_DT
			       , SO.ITEM_DESC
			       , CONCAT(SO.ADD1, SO.ADD2) AS ADD1
				<if test='r_hebechk == null or r_hebechk == "" '>
			       , SO.UNIT
			       , SUM(CASE WHEN SO.STATUS1 = '980' THEN 0  ELSE SO.ORDER_QTY END) AS ORDER_QTY
				</if>
				<if test='r_hebechk != null and r_hebechk == "Y" '>
			       , SO.UNIT1 AS UNIT
			       , SUM(CASE WHEN SO.STATUS1 = '980' THEN 0 ELSE SO.PRIMARY_QTY END) AS ORDER_QTY
				</if>
			FROM O_SALESORDER SO 
			<where>
				<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
				<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
				<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
				<!-- <if test="r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if> -->
				<if test="r_shiptonm != null and r_shiptonm != '' ">AND SHIPTO_NM = TRIM(#{r_shiptonm})</if>
				<if test="ri_add1 != null">
	   				AND ADD1 IN <foreach collection="ri_add1" item="add1" separator="," open="(" close=")">TRIM(#{add1})</foreach>
	   			</if>
				<if test="ri_itemdesc != null">
	   				AND ITEM_DESC IN <foreach collection="ri_itemdesc" item="item_desc" separator="," open="(" close=")">TRIM(#{item_desc})</foreach>
	   			</if>
	   			AND SO.STATUS1 >= '580'
			</where>
			GROUP BY ACTUAL_SHIP_DT
			         , ITEM_DESC
				<if test='r_hebechk == null or r_hebechk == "" '>, UNIT</if>
				<if test='r_hebechk != null and r_hebechk == "Y" '>, UNIT1</if>
			         , CONCAT(ADD1, ADD2) 
		
		) SUB
		<!-- WHERE SUB.ORDER_QTY > 0 -->
	</select>
	
	<select id="getReportFor1020" parameterType="hashmap" resultType="hashmap">
 		SELECT SUB.*
		FROM ( 		
			SELECT SO.ACTUAL_SHIP_DT
			       , SO.ITEM_DESC
			       , CONCAT(SO.ADD1, SO.ADD2) AS ADD1
				<if test='r_hebechk == null or r_hebechk == "" '>
			       , SO.UNIT
			       , SUM(CASE WHEN SO.STATUS1 = '980' THEN 0 ELSE SO.ORDER_QTY END) AS ORDER_QTY
				</if>
				<if test='r_hebechk != null and r_hebechk == "Y" '>
			       , (CASE WHEN OH.HEBE_UM IS NULL THEN (SELECT DISTINCT UNIT FROM O_SALESORDER WHERE ITEM_DESC = SO.ITEM_DESC) ELSE OH.HEBE_UM END) AS UNIT 
			       , ROUND( SUM(CASE WHEN SO.STATUS1 = '980' 
						THEN 0
						ELSE (
							CASE WHEN OH.ITEM_CD IS NOT NULL 
							THEN SO.PRIMARY_QTY * OH.X / OH.Y
							ELSE SO.PRIMARY_QTY
							END
						) END), 0) AS ORDER_QTY
				</if>
			       , SUBSTR(SO.ITEM_CD, 1, 3) AS ITEM_CD_3
			       , CASE WHEN MFG.MFG IS NULL THEN '크나우프 석고보드㈜' ELSE MFG.MFG END  AS MANUFACT
			FROM O_SALESORDER SO 
			LEFT JOIN O_ITEM_HEBE OH ON OH.ITEM_CD = SO.ITEM_CD
			LEFT JOIN O_ITEM_MFG MFG ON SO.ITEM_CD = MFG.ITEM_CD
			<where>
				<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
				<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
				<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
				<!-- <if test="r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if> -->
				<if test="r_shiptonm != null and r_shiptonm != '' ">AND SHIPTO_NM = TRIM(#{r_shiptonm})</if>
				<if test="ri_add1 != null">
	   				AND ADD1 IN <foreach collection="ri_add1" item="add1" separator="," open="(" close=")">TRIM(#{add1})</foreach>
	   			</if>
				<if test="ri_itemdesc != null">
	   				AND ITEM_DESC IN <foreach collection="ri_itemdesc" item="item_desc" separator="," open="(" close=")">TRIM(#{item_desc})</foreach>
	   			</if>
	   			AND SO.STATUS1 >= '580' AND SO.STATUS1 <![CDATA[ <> ]]> '980'
			</where>
			GROUP BY ACTUAL_SHIP_DT
			         , ITEM_DESC
				<if test='r_hebechk == null or r_hebechk == "" '>, SO.UNIT</if>
				<if test='r_hebechk != null and r_hebechk == "Y" '>, OH.HEBE_UM</if>
			         , CONCAT(ADD1, ADD2)
			         , SUBSTR(SO.ITEM_CD, 1, 3)
					 , MFG.MFG
		) SUB
		<!-- WHERE SUB.ORDER_QTY > 0 -->
		<if test=" r_orderby != null and r_orderby != '' ">ORDER BY ${r_orderby}</if>
	</select>
	
	<select id="getCntReportFor1121" parameterType="hashmap" resultType="hashmap">
	
	</select>
	
	<select id="getReportFor1121" parameterType="hashmap" resultType="hashmap">
		SELECT SUB.*
		FROM ( 
		
			SELECT 
				GRP.ITEM_DESC
				, DECODE(GROUPING(GRP.ACTUAL_SHIP_DT), 1, '소계', ACTUAL_SHIP_DT) AS ACTUAL_SHIP_DT
				, SUM(GRP.ORDER_QTY) AS SUM_ORDER_QTY
				, GRP.UNIT
				, GRP.ITEM_CD_3
				, GRP.MANUFACT
				, GRP.ADD1 
			FROM (
		
				SELECT SO.ACTUAL_SHIP_DT
				       , SO.ITEM_DESC
				       , CONCAT(SO.ADD1, SO.ADD2) AS ADD1
				<if test='r_hebechk == null or r_hebechk == "" '>
				       , SO.UNIT
				       , SUM(CASE WHEN SO.STATUS1 = '980' THEN 0 ELSE SO.ORDER_QTY END) AS ORDER_QTY
				</if>
				<if test='r_hebechk != null and r_hebechk == "Y" '>
				       , (CASE WHEN OH.HEBE_UM IS NULL THEN (SELECT DISTINCT UNIT FROM O_SALESORDER WHERE ITEM_DESC = SO.ITEM_DESC) ELSE OH.HEBE_UM END) AS UNIT
				       , ROUND( SUM(CASE WHEN SO.STATUS1 = '980' 
							THEN 0
							ELSE (
								CASE WHEN OH.ITEM_CD IS NOT NULL 
								THEN SO.PRIMARY_QTY * OH.X / OH.Y
								ELSE SO.PRIMARY_QTY
								END
							) END), 0) AS ORDER_QTY
				</if>
				       , SUBSTR(SO.ITEM_CD, 1, 3) AS ITEM_CD_3 
				       , CASE WHEN MFG.MFG IS NULL THEN '크나우프 석고보드㈜' ELSE MFG.MFG END  AS MANUFACT
				FROM O_SALESORDER SO  
				LEFT JOIN O_ITEM_HEBE OH ON OH.ITEM_CD = SO.ITEM_CD
				LEFT JOIN O_ITEM_MFG MFG ON SO.ITEM_CD = MFG.ITEM_CD
				<where>
					<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
					<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
					<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
					<!-- <if test="r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if> -->
					<if test="r_shiptonm != null and r_shiptonm != '' ">AND SHIPTO_NM = TRIM(#{r_shiptonm})</if>
					<if test="ri_add1 != null">
		   				AND ADD1 IN <foreach collection="ri_add1" item="add1" separator="," open="(" close=")">TRIM(#{add1})</foreach>
		   			</if>
					<if test="ri_itemdesc != null">
		   				AND ITEM_DESC IN <foreach collection="ri_itemdesc" item="item_desc" separator="," open="(" close=")">TRIM(#{item_desc})</foreach>
		   			</if>
		   			AND SO.STATUS1 >= '580' AND SO.STATUS1 <![CDATA[ <> ]]> '980'
				</where>
				GROUP BY ITEM_DESC
				         , ACTUAL_SHIP_DT
				<if test='r_hebechk == null or r_hebechk == "" '>, SO.UNIT</if>
				<if test='r_hebechk != null and r_hebechk == "Y" '>, OH.HEBE_UM</if>
				         , CONCAT(ADD1, ADD2)
				         , SUBSTR(SO.ITEM_CD, 1, 3)
				         , MFG.MFG
			) GRP
			
			GROUP BY ROLLUP(GRP.ITEM_DESC, (GRP.ACTUAL_SHIP_DT, GRP.UNIT, GRP.ITEM_CD_3, GRP.ADD1, GRP.MANUFACT)) 
			HAVING GROUPING(GRP.ITEM_DESC) = 0
			
		) SUB
		<!-- WHERE SUB.SUM_ORDER_QTY > 0 -->
		
		<if test=" r_orderby != null and r_orderby != '' ">ORDER BY ${r_orderby}</if>
	</select>
	
	<select id="getReportFor1222" parameterType="hashmap" resultType="hashmap">
		SELECT
			SUB.ITEM_DESC
			, SUB.UNIT
			, SUB.SHIPTO_NM
			, SUB.ORDER_QTY
			, (CASE WHEN SUB.UNIT1 IS NULL THEN SUB.UNIT ELSE SUB.UNIT1 END) AS UNIT1
			, SUB.PRIMARY_QTY
			, SUB.ITEM_CD_3
			, SUB.MANUFACT
		FROM ( 
			SELECT SO.ITEM_DESC
			       , SO.UNIT
			       , MAX(SO.SHIPTO_NM) AS SHIPTO_NM
			       , SUM(CASE WHEN SO.STATUS1 = '980' THEN 0 ELSE SO.ORDER_QTY END) AS ORDER_QTY
			       , OH.HEBE_UM AS UNIT1
			       , ROUND( SUM(CASE WHEN SO.STATUS1 = '980' 
				       	THEN 0 
				       	ELSE (
							CASE WHEN OH.ITEM_CD IS NOT NULL 
							THEN SO.PRIMARY_QTY * OH.X / OH.Y
							ELSE SO.PRIMARY_QTY
							END
				       	) END), 0) AS PRIMARY_QTY
			       , SUBSTR(SO.ITEM_CD, 1, 3) AS ITEM_CD_3 
			       , CASE WHEN MFG.MFG IS NULL THEN '크나우프 석고보드㈜' ELSE MFG.MFG END  AS MANUFACT
			FROM O_SALESORDER SO  
			LEFT JOIN O_ITEM_HEBE OH ON OH.ITEM_CD = SO.ITEM_CD
			LEFT JOIN O_ITEM_MFG MFG ON SO.ITEM_CD = MFG.ITEM_CD
			<where>
				<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
				<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
				<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
				<!-- <if test="r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if> -->
				<if test="r_shiptonm != null and r_shiptonm != '' ">AND SHIPTO_NM = TRIM(#{r_shiptonm})</if>
				<if test="ri_add1 != null">
	   				AND ADD1 IN <foreach collection="ri_add1" item="add1" separator="," open="(" close=")">TRIM(#{add1})</foreach>
	   			</if>
				<if test="ri_itemdesc != null">
	   				AND ITEM_DESC IN <foreach collection="ri_itemdesc" item="item_desc" separator="," open="(" close=")">TRIM(#{item_desc})</foreach>
	   			</if>
	   			AND SO.STATUS1 >= '580' AND SO.STATUS1 <![CDATA[ <> ]]> '980'
			</where>
			GROUP BY ITEM_DESC
			         , SO.UNIT
			         , OH.HEBE_UM
			         , SUBSTR(SO.ITEM_CD, 1, 3)
			         , MFG.MFG
		) SUB
		<!-- WHERE SUB.ORDER_QTY > 0 -->
		<if test=" r_orderby != null and r_orderby != '' ">ORDER BY ${r_orderby}</if>
	</select>
	
	<select id="getReportPeriodDate" parameterType="hashmap" resultType="hashmap">
		SELECT MIN(ACTUAL_SHIP_DT) AS START_DATE, MAX(ACTUAL_SHIP_DT) AS END_DATE 
		FROM O_SALESORDER SO  
		<where>
			<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
			<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
			<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
			<!-- <if test="r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if> -->
			<if test="r_shiptonm != null and r_shiptonm != '' ">AND SHIPTO_NM = TRIM(#{r_shiptonm})</if>
			<if test="ri_add1 != null">
   				AND ADD1 IN <foreach collection="ri_add1" item="add1" separator="," open="(" close=")">TRIM(#{add1})</foreach>
   			</if>
			<if test="ri_itemdesc != null">
   				AND ITEM_DESC IN <foreach collection="ri_itemdesc" item="item_desc" separator="," open="(" close=")">TRIM(#{item_desc})</foreach>
   			</if>
   			AND SO.STATUS1 >= '580' AND SO.STATUS1 <![CDATA[ <> ]]> '980'
		</where>
	</select>
	
	<select id="getOrderAdd1Group" parameterType="hashmap" resultType="hashmap">
		SELECT MIN(ACTUAL_SHIP_DT) AS START_DT, MAX(ACTUAL_SHIP_DT) AS END_DT
		FROM O_SALESORDER  
		<where>
			<if test=" r_wherebody != null and r_wherebody != '' ">AND ${r_wherebody}</if>
		</where>
		GROUP BY ACTUAL_SHIP_DT
		<!-- 		
		SELECT ADD1
		, MIN(ACTUAL_SHIP_DT) AS START_DT, MAX(ACTUAL_SHIP_DT) AS END_DT
		FROM O_SALESORDER  
		<where>
			<if test=" r_wherebody != null and r_wherebody != '' ">AND ${r_wherebody}</if>
		</where>
		GROUP BY ADD1
 		-->		
	</select>
	
	<select id="getOrderAdd1Group2" parameterType="hashmap" resultType="hashmap">
		SELECT AD.* FROM (
			SELECT ADD1
			FROM O_SALESORDER  
			<where>
				<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
				<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
				<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
				AND STATUS1 >= '580' AND STATUS1 <![CDATA[ <> ]]> '980'
			</where>
			GROUP BY ADD1
		) AD
		
		ORDER BY AD.ADD1 ASC
	</select>
	
	<select id="getOrderItemDescGroup" parameterType="hashmap" resultType="hashmap">
		SELECT IT.* FROM (
	
		SELECT ITEM_DESC
		FROM O_SALESORDER  
		<where>
			<if test="r_actualshipsdt != null and r_actualshipsdt != '' ">AND ACTUAL_SHIP_DT <![CDATA[>=]]> #{r_actualshipsdt}</if>
			<if test="r_actualshipedt != null and r_actualshipedt != '' ">AND ACTUAL_SHIP_DT <![CDATA[<=]]> #{r_actualshipedt}</if>
			<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
			<!-- <if test="r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if> -->
			<if test="r_shiptonm != null and r_shiptonm != '' ">AND SHIPTO_NM = TRIM(#{r_shiptonm})</if>
			<if test="ri_add1 != null">
   				AND ADD1 IN <foreach collection="ri_add1" item="add1" separator="," open="(" close=")">TRIM(#{add1})</foreach>
   			</if>
   			AND STATUS1 >= '580' AND STATUS1 <![CDATA[ <> ]]> '980'
		</where>
		GROUP BY ITEM_DESC
		
		) IT
		
		ORDER BY IT.ITEM_DESC ASC
	</select>
	
	<select id="getDeliveryPaperList" parameterType="hashmap" resultType="hashmap">
		SELECT SO.*
			, (SELECT SALESREP_NM FROM O_CUSTOMER CU WHERE CU.CUST_CD = SO.CUST_CD) AS NOW_SALES_NM
		FROM O_SALESORDER SO  
		<where>
			<if test=" r_wherebody != null and r_wherebody != '' ">AND ${r_wherebody}</if>
			<!-- <if test=" r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if> -->
			<if test=" r_shiptonm != null and r_shiptonm != '' ">AND SHIPTO_CD = TRIM(#{r_shiptonm})</if>
			<if test=" r_itemdesc != null and r_itemdesc != '' ">AND ITEM_DESC = TRIM(#{r_itemdesc})</if>
			<if test=" r_add1 != null and r_add1 != '' ">AND ADD1 = TRIM(#{r_add1})</if>
		</where>
		ORDER BY ${r_orderby}
	</select>
	
	<select id="getDeliveryPaperListForItemGroup" parameterType="hashmap" resultType="hashmap">
		SELECT A.* 
		    , COUNT(*) OVER(PARTITION BY ITEM_DESC) AS ITEM_CNT
		    , SUM(ORDER_QTY) OVER(PARTITION BY ITEM_DESC) AS ITEM_SUM
		FROM(
		    SELECT SO.ORDERNO, SO.ORDERTY, SO.LINE_NO, SO.CUST_CD, SO.CUST_NM, SO.SHIPTO_NM, SO.ITEM_DESC, SO.ACTUAL_SHIP_DT, SO.UNIT, SO.ADD1, SO.ADD2, SO.ORDER_QTY
		    , (SELECT SALESREP_NM FROM O_CUSTOMER CU WHERE CU.CUST_CD = SO.CUST_CD) AS NOW_SALES_NM 
		    FROM O_SALESORDER SO
		    <where>
				<if test=" r_wherebody != null and r_wherebody != '' ">AND ${r_wherebody}</if>
				<!-- <if test=" r_shiptocd != null and r_shiptocd != '' ">AND SHIPTO_CD = #{r_shiptocd}</if> -->
				<if test=" r_shiptonm != null and r_shiptonm != '' ">AND SHIPTO_NM = TRIM(#{r_shiptonm})</if>
				<if test=" r_itemdesc != null and r_itemdesc != '' ">AND ITEM_DESC = TRIM(#{r_itemdesc})</if>
				<if test=" r_add1 != null and r_add1 != '' ">AND ADD1 = TRIM(#{r_add1})</if>
			</where>  
		) A
		ORDER BY ${r_orderby} 
	</select>
	<!-- End. 납품확인서 리스트 -->
	
	<select id="getCustInfoForReport" parameterType="hashmap" resultType="hashmap">
		SELECT CUST_NM, SALESREP_NM
			<!-- <if test="r_shiptocd != null and r_shiptocd != '' ">,(SELECT SHIPTO_NM FROM O_SHIPTO WHERE SHIPTO_CD = #{r_shiptocd}) AS SHIPTO_NM</if> -->
			<if test="r_shiptonm != null and r_shiptonm != '' ">, TRIM(#{r_shiptonm}) AS SHIPTO_NM</if>
		FROM O_CUSTOMER
		<where>
			<if test="r_custcd != null and r_custcd != '' ">AND CUST_CD = #{r_custcd}</if>
		</where>
	</select>
	
	<!-- Start. 배차완료 푸시를 위한. -->
	<select id="getListForSendPush" parameterType="hashmap" resultType="hashmap">
		SELECT SALL.*, US.USERID, US.USER_APPPUSHKEY
		FROM ( 
		
			SELECT SO.*, REPLACE(SO.CUST_PO, ' ', '') AS SO_CUSTPO, SOP.*
			FROM O_SALESORDER SO
				LEFT JOIN SALESORDERPUSH SOP ON SO.ORDERNO = SOP.SOP_ORDERNO AND SO.ORDERTY = SOP.SOP_ORDERTY AND SO.LINE_NO = SOP.SOP_LINENO
			<where>
				AND (SOP.SOP_PUSHYN530 IS NULL OR NVL(SOP.SOP_PUSHYN530, ' ') = ' ')
				<if test="r_ordersdt != null and r_ordersdt != '' ">AND SO.ORDER_DT <![CDATA[>=]]> #{r_ordersdt}</if>
				<if test="r_orderedt != null and r_orderedt != '' ">AND SO.ORDER_DT <![CDATA[<=]]> #{r_orderedt}</if>
				<if test="r_status2 != null and r_status2 != '' ">AND SO.STATUS2 = #{r_status2}</if>
			</where>
		
		) SALL
			LEFT JOIN O_ORDER_CONFIRM_H OCH ON SALL.SO_CUSTPO = OCH.CUST_PO
			LEFT JOIN O_USER US ON REPLACE(OCH.USERID, ' ', '') = US.USERID
		<where>
			AND (NVL(SALL.SO_CUSTPO, ' ') != ' ')
			AND (US.USER_APPPUSHKEY IS NOT NULL AND NVL(US.USER_APPPUSHKEY, ' ') != ' ')
			AND US.USER_APPPUSHYN2 = 'Y'
		</where>
	</select>
	
	<select id="getListForSendPushGroup" parameterType="hashmap" resultType="hashmap">
		SELECT US.USERID, US.USER_APPPUSHKEY, COUNT(DISTINCT(SALL.SO_CUSTPO)) AS CNT
			, MAX(SALL.SO_CUSTPO) AS ORDERNO_MAX
			<!-- , MAX(SALL.ORDERNO) AS ORDERNO_MAX -->
		FROM ( 
		
			SELECT SO.*, REPLACE(SO.CUST_PO, ' ', '') AS SO_CUSTPO, SOP.*
			FROM O_SALESORDER SO
				LEFT JOIN SALESORDERPUSH SOP ON SO.ORDERNO = SOP.SOP_ORDERNO AND SO.ORDERTY = SOP.SOP_ORDERTY AND SO.LINE_NO = SOP.SOP_LINENO
			<where>
				AND (SOP.SOP_PUSHYN530 IS NULL OR NVL(SOP.SOP_PUSHYN530, ' ') = ' ')
				<if test="r_ordersdt != null and r_ordersdt != '' ">AND SO.ORDER_DT <![CDATA[>=]]> #{r_ordersdt}</if>
				<if test="r_orderedt != null and r_orderedt != '' ">AND SO.ORDER_DT <![CDATA[<=]]> #{r_orderedt}</if>
				<if test="r_status2 != null and r_status2 != '' ">AND SO.STATUS2 = #{r_status2}</if>
			</where>
		
		) SALL
			LEFT JOIN O_ORDER_CONFIRM_H OCH ON SALL.SO_CUSTPO = OCH.CUST_PO
			LEFT JOIN O_USER US ON REPLACE(OCH.USERID, ' ', '') = US.USERID
		<where>
			AND (NVL(SALL.SO_CUSTPO, ' ') != ' ')
			AND (US.USER_APPPUSHKEY IS NOT NULL AND NVL(US.USER_APPPUSHKEY, ' ') != ' ')
			AND US.USER_APPPUSHYN2 = 'Y'
		</where>
		GROUP BY US.USERID, US.USER_APPPUSHKEY, SALL.SO_CUSTPO
	</select>
	
	<insert id="inSalesOrderPush" parameterType="hashmap">
		INSERT INTO SALESORDERPUSH(
			SOP_ORDERNO
			, SOP_ORDERTY
			, SOP_LINENO
			, SOP_CUSTCD
			, SOP_USERID
			, SOP_USERAPPPUSHKEY
			, SOP_PUSHYN530
		)VALUES(
			#{m_soporderno, jdbcType=NUMERIC}
			, #{m_soporderty, jdbcType=VARCHAR}
			, #{m_soplineno, jdbcType=NUMERIC}
			, #{m_sopcustcd, jdbcType=VARCHAR}
			, #{m_sopuserid, jdbcType=VARCHAR}
			, #{m_sopuserapppushkey, jdbcType=VARCHAR}
			, #{m_soppushyn530, jdbcType=VARCHAR}
		)
	</insert>
	
	
	<!-- END. 배차완료 푸시를 위한. -->
	
	<select id="syncOrderDeleteUpdate"  statementType="CALLABLE" parameterType="hashmap"  resultType="hashmap">
		{call SP_ORDER_DELETE_UPDATE() }
	</select> 
	
	<select id="getShiptoListWithQuoteQt" parameterType="hashmap" resultType="hashmap">
		SELECT S.SHIPTO_CD
			, S.SHIPTO_NM
			, S.QUOTE_QT
			, S.CUST_CD
		FROM O_SHIPTO S
		INNER JOIN (SELECT QUOTE_QT FROM O_SHIPTO WHERE SHIPTO_CD = #{m_shiptocd}) A  
			ON A.QUOTE_QT = S.QUOTE_QT
		WHERE 1=1 
			AND S.CUST_CD = #{m_custcd}
	</select>
	
	
	<select id="syncSalesOrderDeliveryComplete"  statementType="CALLABLE" parameterType="hashmap"  resultType="hashmap">
		{call SP_SALESORDER_DELIVERY() }
	</select> 
</mapper>